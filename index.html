<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Superhuman">
<meta name="theme-color" content="#0A0A0F">
<title>âš¡ Superhuman Tracker</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap');

:root {
  --bg: #0A0A0F;
  --bg2: #111118;
  --bg3: #1A1A28;
  --card: #16161E;
  --card2: #1E1E2C;
  --border: rgba(255,255,255,0.08);
  --orange: #FF6B35;
  --teal: #00D4AA;
  --purple: #8B5CF6;
  --yellow: #F59E0B;
  --red: #FF4444;
  --green: #22C55E;
  --text: #F0F0F5;
  --muted: rgba(240,240,245,0.45);
  --radius: 16px;
  --safe-top: env(safe-area-inset-top);
  --safe-bot: env(safe-area-inset-bottom);
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body {
  font-family: 'Syne', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  min-height: -webkit-fill-available;
  overflow-x: hidden;
  padding-bottom: calc(80px + var(--safe-bot));
}

/* NAV */
.nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: rgba(10,10,15,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  padding: 8px 0 calc(8px + var(--safe-bot));
  display: flex;
  z-index: 100;
}

.nav-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  padding: 6px 4px;
  border: none;
  background: none;
  color: var(--muted);
  font-family: 'Syne', sans-serif;
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.03em;
  cursor: pointer;
  transition: all 0.2s;
}

.nav-btn .icon { font-size: 22px; line-height: 1; }

.nav-btn.active { color: var(--text); }
.nav-btn.active .icon { transform: scale(1.15); }

.nav-btn[data-tab="training"].active { color: var(--orange); }
.nav-btn[data-tab="habits"].active { color: var(--teal); }
.nav-btn[data-tab="mind"].active { color: var(--purple); }
.nav-btn[data-tab="social"].active { color: var(--yellow); }

/* HEADER */
.header {
  padding: calc(var(--safe-top) + 20px) 20px 20px;
  background: linear-gradient(180deg, var(--bg2) 0%, transparent 100%);
  position: sticky;
  top: 0;
  z-index: 50;
  backdrop-filter: blur(10px);
}

.header-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 4px;
}

.header-title {
  font-size: 22px;
  font-weight: 800;
  letter-spacing: -0.02em;
}

.header-date {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  color: var(--muted);
}

.header-streak {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  font-weight: 600;
  color: var(--orange);
  background: rgba(255,107,53,0.12);
  padding: 4px 10px;
  border-radius: 20px;
}

/* SCREENS */
.screen { display: none; padding: 0 16px; animation: fadeIn 0.25s ease; }
.screen.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* CARDS */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 12px;
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 14px;
}

.card-title {
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--muted);
}

.card-badge {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 6px;
  font-weight: 500;
}

/* SECTION TITLE */
.section-label {
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--muted);
  margin: 20px 0 10px 4px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRAINING SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.month-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.month-day-label {
  text-align: center;
  font-size: 9px;
  font-weight: 700;
  color: var(--muted);
  letter-spacing: 0.05em;
  padding-bottom: 4px;
}

.month-day {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  position: relative;
  font-family: 'DM Mono', monospace;
}

.month-day.empty { opacity: 0; pointer-events: none; }
.month-day.today { outline: 2px solid var(--orange); outline-offset: -2px; }
.month-day.trained {
  background: var(--orange);
  color: white;
}
.month-day.rest {
  background: var(--bg3);
  color: var(--muted);
}
.month-day:active { transform: scale(0.92); }

/* Session detail modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(6px);
  z-index: 200;
  display: none;
  align-items: flex-end;
  justify-content: center;
}
.modal-overlay.open { display: flex; }

.modal {
  background: var(--card2);
  border: 1px solid var(--border);
  border-radius: 24px 24px 0 0;
  padding: 20px 20px calc(20px + var(--safe-bot));
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  animation: slideUp 0.3s cubic-bezier(0.32, 0.72, 0, 1);
}

@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

.modal-handle {
  width: 36px;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  margin: 0 auto 20px;
}

.modal-title {
  font-size: 20px;
  font-weight: 800;
  margin-bottom: 6px;
}

.modal-sub {
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 20px;
}

.exercise-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}
.exercise-row:last-child { border-bottom: none; }

.ex-name { font-size: 14px; font-weight: 600; }
.ex-cat { font-size: 11px; color: var(--muted); margin-top: 2px; }
.ex-stats {
  text-align: right;
  font-family: 'DM Mono', monospace;
}
.ex-weight { font-size: 16px; font-weight: 700; color: var(--orange); }
.ex-detail { font-size: 11px; color: var(--muted); }

/* Progress table */
.progress-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}
.progress-table th {
  background: var(--bg3);
  padding: 8px;
  text-align: center;
  color: var(--muted);
  font-size: 10px;
  letter-spacing: 0.06em;
  text-transform: uppercase;
}
.progress-table td {
  padding: 10px 8px;
  text-align: center;
  border-bottom: 1px solid var(--border);
  font-family: 'DM Mono', monospace;
}
.progress-table tr:last-child td { border-bottom: none; }
.progress-table .ex-col { text-align: left; font-family: 'Syne', sans-serif; font-weight: 600; font-size: 13px; }
.progress-table .highlight { color: var(--teal); font-weight: 700; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HABITS SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.habit-streak-card {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
}
.habit-streak-card:last-child { border-bottom: none; }

.habit-icon { font-size: 28px; flex-shrink: 0; }

.habit-info { flex: 1; min-width: 0; }
.habit-name { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
.habit-meta { font-size: 11px; color: var(--muted); }

.habit-streak-num {
  font-family: 'DM Mono', monospace;
  font-size: 28px;
  font-weight: 700;
  flex-shrink: 0;
  text-align: right;
  line-height: 1;
}
.habit-streak-unit { font-size: 10px; color: var(--muted); text-align: right; }

.streak-bar-wrap {
  height: 4px;
  background: var(--bg3);
  border-radius: 2px;
  margin-top: 6px;
  overflow: hidden;
}
.streak-bar {
  height: 100%;
  border-radius: 2px;
  transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Cal mini */
.cal-mini {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 3px;
}
.cal-day-label {
  text-align: center;
  font-size: 9px;
  color: var(--muted);
  font-weight: 700;
  letter-spacing: 0.04em;
  padding-bottom: 3px;
}
.cal-day {
  aspect-ratio: 1;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-family: 'DM Mono', monospace;
  font-weight: 500;
}
.cal-day.t { background: var(--teal); color: var(--bg); font-weight: 700; }
.cal-day.r { background: var(--bg3); color: var(--muted); }
.cal-day.e { opacity: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MIND SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.book-card {
  display: flex;
  align-items: flex-start;
  gap: 14px;
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
}
.book-card:last-child { border-bottom: none; }

.book-cover {
  width: 44px;
  height: 60px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.book-info { flex: 1; min-width: 0; }
.book-title { font-size: 14px; font-weight: 700; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.book-author { font-size: 12px; color: var(--muted); margin-bottom: 6px; }
.book-status {
  display: inline-block;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.06em;
  padding: 3px 8px;
  border-radius: 6px;
}

.topic-card {
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
}
.topic-card:last-child { border-bottom: none; }
.topic-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.topic-name { font-size: 14px; font-weight: 700; }
.topic-pct { font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 700; }
.topic-meta { font-size: 11px; color: var(--muted); margin-bottom: 8px; }
.topic-bar-wrap { height: 6px; background: var(--bg3); border-radius: 3px; overflow: hidden; }
.topic-bar { height: 100%; border-radius: 3px; transition: width 0.6s; }

/* ADD FORM */
.add-btn {
  width: 100%;
  padding: 14px;
  background: transparent;
  border: 2px dashed var(--border);
  border-radius: var(--radius);
  color: var(--muted);
  font-family: 'Syne', sans-serif;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 8px;
}
.add-btn:active { background: var(--bg3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SOCIAL SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.bday-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}
.bday-row:last-child { border-bottom: none; }
.bday-avatar {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}
.bday-info { flex: 1; }
.bday-name { font-size: 14px; font-weight: 700; margin-bottom: 2px; }
.bday-rel { font-size: 11px; color: var(--muted); }
.bday-date {
  font-family: 'DM Mono', monospace;
  font-size: 13px;
  font-weight: 700;
  color: var(--yellow);
}
.bday-days { font-size: 10px; color: var(--muted); text-align: right; }

.contact-card {
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
}
.contact-card:last-child { border-bottom: none; }
.contact-header { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
.contact-avatar {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  background: var(--bg3);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}
.contact-name { font-size: 14px; font-weight: 700; }
.contact-role { font-size: 11px; color: var(--muted); }
.contact-tags { display: flex; flex-wrap: wrap; gap: 6px; }
.tag {
  font-size: 10px;
  font-weight: 700;
  padding: 3px 8px;
  border-radius: 6px;
  background: var(--bg3);
  color: var(--muted);
}

/* Exposure log */
.exposure-row {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}
.exposure-row:last-child { border-bottom: none; }
.exposure-dots {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  padding-top: 4px;
}
.e-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}
.exposure-content { flex: 1; }
.exposure-act { font-size: 14px; font-weight: 700; margin-bottom: 3px; }
.exposure-meta { font-size: 11px; color: var(--muted); }
.discomfort {
  display: flex;
  gap: 3px;
  margin-top: 6px;
}
.d-star { font-size: 12px; }

/* STAT GRID */
.stat-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 12px;
}
.stat-cell {
  background: var(--bg3);
  border-radius: 12px;
  padding: 14px 12px;
  text-align: center;
}
.stat-num {
  font-family: 'DM Mono', monospace;
  font-size: 28px;
  font-weight: 700;
  line-height: 1;
  margin-bottom: 4px;
}
.stat-lbl {
  font-size: 10px;
  color: var(--muted);
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
}

/* INPUT STYLES */
input, textarea, select {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-family: 'Syne', sans-serif;
  font-size: 14px;
  padding: 10px 12px;
  width: 100%;
  outline: none;
  -webkit-appearance: none;
}
input:focus, textarea:focus, select:focus {
  border-color: rgba(255,255,255,0.2);
}

.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
.form-group { margin-bottom: 10px; }
.form-label { font-size: 11px; color: var(--muted); font-weight: 700; letter-spacing: 0.06em; margin-bottom: 4px; display: block; }

.btn-primary {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: var(--radius);
  font-family: 'Syne', sans-serif;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 6px;
  transition: transform 0.15s, opacity 0.15s;
}
.btn-primary:active { transform: scale(0.97); opacity: 0.8; }

/* Close btn */
.close-btn {
  border: none;
  background: var(--bg3);
  color: var(--muted);
  border-radius: 10px;
  padding: 8px 14px;
  font-family: 'Syne', sans-serif;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  float: right;
}
</style>
</head>
<body>

<!-- TRAINING MODAL -->
<div class="modal-overlay" id="sessionModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <button class="close-btn" onclick="closeModal()">âœ• Cerrar</button>
    <div class="modal-title" id="modalDate">â€”</div>
    <div class="modal-sub" id="modalSub">â€”</div>
    <div id="modalContent"></div>
  </div>
</div>

<!-- ADD HABIT MODAL -->
<div class="modal-overlay" id="addHabitModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <button class="close-btn" onclick="document.getElementById('addHabitModal').classList.remove('open')">âœ•</button>
    <div class="modal-title">Nuevo HÃ¡bito</div>
    <div class="modal-sub" style="margin-bottom:16px">Configura la fecha de inicio</div>
    <div class="form-group">
      <label class="form-label">Nombre del hÃ¡bito</label>
      <input type="text" id="newHabitName" placeholder="Ej: Sin cafeÃ­na">
    </div>
    <div class="form-group">
      <label class="form-label">Emoji</label>
      <input type="text" id="newHabitEmoji" placeholder="ğŸš«" maxlength="2">
    </div>
    <div class="form-group">
      <label class="form-label">Fecha de inicio</label>
      <input type="date" id="newHabitDate">
    </div>
    <button class="btn-primary" style="background:var(--teal);color:var(--bg)" onclick="addHabit()">Agregar HÃ¡bito</button>
  </div>
</div>

<!-- ADD SESSION MODAL -->
<div class="modal-overlay" id="addSessionModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <button class="close-btn" onclick="document.getElementById('addSessionModal').classList.remove('open')">âœ•</button>
    <div class="modal-title">Registrar SesiÃ³n</div>
    <div class="modal-sub" style="margin-bottom:16px">Agrega los ejercicios de hoy</div>
    <div class="form-group">
      <label class="form-label">Fecha</label>
      <input type="date" id="sessionDate">
    </div>
    <div id="exerciseInputs">
      <div class="form-row">
        <div class="form-group"><label class="form-label">Ejercicio</label><input type="text" class="ex-name-in" placeholder="Press Banca"></div>
        <div class="form-group"><label class="form-label">CategorÃ­a</label><input type="text" class="ex-cat-in" placeholder="Pecho"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Series</label><input type="number" class="ex-sets-in" placeholder="4"></div>
        <div class="form-group"><label class="form-label">Reps</label><input type="number" class="ex-reps-in" placeholder="8"></div>
      </div>
      <div class="form-group"><label class="form-label">Peso (kg)</label><input type="number" class="ex-weight-in" placeholder="80" step="0.5"></div>
    </div>
    <button class="add-btn" onclick="addExerciseInput()">+ AÃ±adir ejercicio</button>
    <button class="btn-primary" style="background:var(--orange);color:white;margin-top:12px" onclick="saveSession()">ğŸ’¾ Guardar SesiÃ³n</button>
  </div>
</div>

<!-- ADD BOOK MODAL -->
<div class="modal-overlay" id="addBookModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <button class="close-btn" onclick="document.getElementById('addBookModal').classList.remove('open')">âœ•</button>
    <div class="modal-title">Agregar Libro</div>
    <div class="modal-sub" style="margin-bottom:16px">Registra tu lectura</div>
    <div class="form-group"><label class="form-label">TÃ­tulo</label><input type="text" id="bookTitle" placeholder="Nombre del libro"></div>
    <div class="form-group"><label class="form-label">Autor</label><input type="text" id="bookAuthor" placeholder="Autor"></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">CategorÃ­a</label><input type="text" id="bookCat" placeholder="PsicologÃ­a"></div>
      <div class="form-group"><label class="form-label">Estado</label>
        <select id="bookStatus">
          <option value="ğŸ“– Leyendo">ğŸ“– Leyendo</option>
          <option value="âœ… LeÃ­do">âœ… LeÃ­do</option>
          <option value="ğŸ“‹ Pendiente">ğŸ“‹ Pendiente</option>
        </select>
      </div>
    </div>
    <div class="form-group"><label class="form-label">Rating (1-5)</label><input type="number" id="bookRating" min="1" max="5" placeholder="5"></div>
    <button class="btn-primary" style="background:var(--purple);color:white" onclick="addBook()">Agregar Libro</button>
  </div>
</div>

<!-- ADD CONTACT MODAL -->
<div class="modal-overlay" id="addContactModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <button class="close-btn" onclick="document.getElementById('addContactModal').classList.remove('open')">âœ•</button>
    <div class="modal-title">Nuevo Contacto</div>
    <div class="modal-sub" style="margin-bottom:16px">Expande tu red</div>
    <div class="form-group"><label class="form-label">Nombre</label><input type="text" id="contactName" placeholder="Nombre completo"></div>
    <div class="form-group"><label class="form-label">Rol / ProfesiÃ³n</label><input type="text" id="contactRole" placeholder="Ingeniero, MÃ©dico..."></div>
    <div class="form-group"><label class="form-label">CÃ³mo lo conociste</label><input type="text" id="contactHow" placeholder="Gym, trabajo, evento..."></div>
    <div class="form-group"><label class="form-label">Intereses comunes</label><input type="text" id="contactInterests" placeholder="Deporte, emprendimiento..."></div>
    <div class="form-group"><label class="form-label">CumpleaÃ±os (opcional)</label><input type="text" id="contactBday" placeholder="DD/MM"></div>
    <button class="btn-primary" style="background:var(--yellow);color:var(--bg)" onclick="addContact()">Agregar Contacto</button>
  </div>
</div>

<!-- ADD EXPOSURE MODAL -->
<div class="modal-overlay" id="addExposureModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <button class="close-btn" onclick="document.getElementById('addExposureModal').classList.remove('open')">âœ•</button>
    <div class="modal-title">ExposiciÃ³n Social</div>
    <div class="modal-sub" style="margin-bottom:16px">Registra tu interacciÃ³n</div>
    <div class="form-group"><label class="form-label">Actividad</label><input type="text" id="expAct" placeholder="ConversÃ© con desconocido..."></div>
    <div class="form-group"><label class="form-label">Personas involucradas</label><input type="text" id="expPeople" placeholder="Nombres o descripciÃ³n"></div>
    <div class="form-group"><label class="form-label">Incomodidad (1-5)</label><input type="number" id="expDiscomfort" min="1" max="5" placeholder="3"></div>
    <div class="form-group"><label class="form-label">ReflexiÃ³n</label><textarea id="expNote" rows="3" placeholder="Â¿QuÃ© aprendiste?"></textarea></div>
    <button class="btn-primary" style="background:var(--yellow);color:var(--bg)" onclick="addExposure()">Registrar</button>
  </div>
</div>

<!-- MAIN CONTENT -->
<div class="header">
  <div class="header-top">
    <div class="header-title" id="headerTitle">âš¡ Superhuman</div>
    <div id="headerStreak" class="header-streak"></div>
  </div>
  <div class="header-date" id="headerDate"></div>
</div>

<!-- â•â• TRAINING â•â• -->
<div class="screen active" id="screen-training">

  <div class="section-label">Febrero 2025</div>
  <div class="card">
    <div class="card-header">
      <span class="card-title">ğŸ‹ï¸ Sesiones del mes</span>
      <span class="card-badge" id="sessionCount" style="background:rgba(255,107,53,0.15);color:var(--orange)">â€” sesiones</span>
    </div>
    <div class="month-grid">
      <div class="month-day-label">L</div><div class="month-day-label">M</div>
      <div class="month-day-label">X</div><div class="month-day-label">J</div>
      <div class="month-day-label">V</div><div class="month-day-label">S</div>
      <div class="month-day-label">D</div>
      <div id="monthGrid"></div>
    </div>
  </div>

  <button class="add-btn" onclick="document.getElementById('addSessionModal').classList.add('open'); document.getElementById('sessionDate').value=new Date().toISOString().slice(0,10)">
    <span>+</span> Registrar sesiÃ³n de hoy
  </button>

  <div class="section-label">ProyecciÃ³n Sobrecarga Progresiva</div>
  <div class="card">
    <div class="card-header">
      <span class="card-title">ğŸ“ˆ +2.5% por semana</span>
      <span class="card-badge" style="background:rgba(0,212,170,0.15);color:var(--teal)">6 semanas</span>
    </div>
    <table class="progress-table">
      <tr>
        <th class="ex-col" style="text-align:left">Ejercicio</th>
        <th>Actual</th>
        <th>S2</th>
        <th>S4</th>
        <th>3M</th>
      </tr>
      <tbody id="projectionTable"></tbody>
    </table>
  </div>
</div>

<!-- â•â• HABITS â•â• -->
<div class="screen" id="screen-habits">

  <div class="section-label">Rachas activas</div>
  <div class="card" id="habitsContainer"></div>

  <button class="add-btn" onclick="document.getElementById('addHabitModal').classList.add('open'); document.getElementById('newHabitDate').value=new Date().toISOString().slice(0,10)">
    <span>+</span> Nuevo hÃ¡bito
  </button>

  <div class="section-label">Calendario de entrenamiento</div>
  <div class="card">
    <div class="card-header">
      <span class="card-title">ğŸ“… Feb 2025</span>
      <span class="card-badge" id="trainedCount" style="background:rgba(0,212,170,0.15);color:var(--teal)">â€” dÃ­as</span>
    </div>
    <div class="cal-mini">
      <div class="cal-day-label">L</div><div class="cal-day-label">M</div>
      <div class="cal-day-label">X</div><div class="cal-day-label">J</div>
      <div class="cal-day-label">V</div><div class="cal-day-label">S</div>
      <div class="cal-day-label">D</div>
      <div id="calMiniGrid"></div>
    </div>
  </div>
</div>

<!-- â•â• MIND â•â• -->
<div class="screen" id="screen-mind">

  <div class="stat-grid">
    <div class="stat-cell">
      <div class="stat-num" id="booksReadCount" style="color:var(--purple)">0</div>
      <div class="stat-lbl">Libros leÃ­dos</div>
    </div>
    <div class="stat-cell">
      <div class="stat-num" id="topicsCount" style="color:var(--teal)">0</div>
      <div class="stat-lbl">Temas activos</div>
    </div>
  </div>

  <div class="section-label">Biblioteca</div>
  <div class="card" id="booksContainer"></div>

  <button class="add-btn" onclick="document.getElementById('addBookModal').classList.add('open')">
    <span>+</span> Agregar libro
  </button>

  <div class="section-label">Aprendizaje activo</div>
  <div class="card" id="topicsContainer"></div>
</div>

<!-- â•â• SOCIAL â•â• -->
<div class="screen" id="screen-social">

  <div class="stat-grid">
    <div class="stat-cell">
      <div class="stat-num" id="contactsCount" style="color:var(--yellow)">0</div>
      <div class="stat-lbl">Contactos</div>
    </div>
    <div class="stat-cell">
      <div class="stat-num" id="exposuresCount" style="color:var(--orange)">0</div>
      <div class="stat-lbl">Exposiciones</div>
    </div>
  </div>

  <div class="section-label">CumpleaÃ±os prÃ³ximos</div>
  <div class="card" id="bdayContainer"></div>

  <div class="section-label">Red de contactos</div>
  <div class="card" id="contactsContainer"></div>

  <button class="add-btn" onclick="document.getElementById('addContactModal').classList.add('open')">
    <span>+</span> Agregar contacto
  </button>

  <div class="section-label">ExposiciÃ³n social</div>
  <div class="card" id="exposureContainer"></div>

  <button class="add-btn" onclick="document.getElementById('addExposureModal').classList.add('open')">
    <span>+</span> Registrar interacciÃ³n
  </button>
</div>

<!-- BOTTOM NAV -->
<nav class="nav">
  <button class="nav-btn active" data-tab="training" onclick="switchTab('training')">
    <span class="icon">ğŸ‹ï¸</span>Training
  </button>
  <button class="nav-btn" data-tab="habits" onclick="switchTab('habits')">
    <span class="icon">ğŸŒ±</span>HÃ¡bitos
  </button>
  <button class="nav-btn" data-tab="mind" onclick="switchTab('mind')">
    <span class="icon">ğŸ“š</span>Mente
  </button>
  <button class="nav-btn" data-tab="social" onclick="switchTab('social')">
    <span class="icon">ğŸ¤</span>Social
  </button>
</nav>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const STORE_KEY = 'superhuman_v2';

function loadState() {
  try {
    const saved = localStorage.getItem(STORE_KEY);
    if (saved) return JSON.parse(saved);
  } catch(e) {}
  return getDefaultState();
}

function saveState() {
  try { localStorage.setItem(STORE_KEY, JSON.stringify(state)); } catch(e) {}
}

function getDefaultState() {
  return {
    sessions: [
      { date: '2025-02-03', exercises: [
        { name: 'Press Banca', cat: 'Pecho', sets: 4, reps: 8, weight: 80 },
        { name: 'Press Inclinado', cat: 'Pecho', sets: 3, reps: 10, weight: 60 },
        { name: 'Fondos', cat: 'Pecho', sets: 3, reps: 12, weight: 0 },
      ]},
      { date: '2025-02-05', exercises: [
        { name: 'Sentadilla', cat: 'Pierna', sets: 4, reps: 6, weight: 100 },
        { name: 'Prensa', cat: 'Pierna', sets: 3, reps: 12, weight: 150 },
        { name: 'Extensiones', cat: 'Pierna', sets: 3, reps: 15, weight: 40 },
      ]},
      { date: '2025-02-07', exercises: [
        { name: 'Peso Muerto', cat: 'Espalda', sets: 4, reps: 5, weight: 120 },
        { name: 'Remo con Barra', cat: 'Espalda', sets: 4, reps: 8, weight: 80 },
        { name: 'JalÃ³n Polea', cat: 'Espalda', sets: 3, reps: 10, weight: 70 },
      ]},
      { date: '2025-02-10', exercises: [
        { name: 'Press Militar', cat: 'Hombro', sets: 4, reps: 8, weight: 60 },
        { name: 'Elevaciones Lat.', cat: 'Hombro', sets: 3, reps: 15, weight: 14 },
        { name: 'Curl BÃ­ceps', cat: 'Brazos', sets: 3, reps: 12, weight: 20 },
      ]},
      { date: '2025-02-12', exercises: [
        { name: 'Press Banca', cat: 'Pecho', sets: 4, reps: 8, weight: 82.5 },
        { name: 'Press Inclinado', cat: 'Pecho', sets: 3, reps: 10, weight: 62.5 },
      ]},
      { date: '2025-02-14', exercises: [
        { name: 'Sentadilla', cat: 'Pierna', sets: 4, reps: 6, weight: 102.5 },
        { name: 'Peso Muerto', cat: 'Espalda', sets: 4, reps: 5, weight: 122.5 },
      ]},
      { date: '2025-02-17', exercises: [
        { name: 'Press Militar', cat: 'Hombro', sets: 4, reps: 8, weight: 62.5 },
        { name: 'Remo con Barra', cat: 'Espalda', sets: 4, reps: 8, weight: 82.5 },
      ]},
      { date: '2025-02-19', exercises: [
        { name: 'Press Banca', cat: 'Pecho', sets: 4, reps: 8, weight: 85 },
        { name: 'Fondos', cat: 'Pecho', sets: 4, reps: 12, weight: 0 },
      ]},
      { date: '2025-02-21', exercises: [
        { name: 'Sentadilla', cat: 'Pierna', sets: 4, reps: 6, weight: 105 },
        { name: 'Extensiones', cat: 'Pierna', sets: 3, reps: 15, weight: 42.5 },
      ]},
    ],
    habits: [
      { id: 1, name: 'Sin Alcohol', emoji: 'ğŸº', startDate: '2025-01-01', color: '#FF6B35' },
      { id: 2, name: 'Sin Golosinas', emoji: 'ğŸ¬', startDate: '2025-01-15', color: '#FF4444' },
      { id: 3, name: 'Sin Bebidas Azucaradas', emoji: 'ğŸ¥¤', startDate: '2025-01-01', color: '#F59E0B' },
      { id: 4, name: 'Sin EnergÃ©ticas', emoji: 'âš¡', startDate: '2025-01-01', color: '#FFCC00' },
      { id: 5, name: '2L Agua Diaria', emoji: 'ğŸ’§', startDate: '2025-02-01', color: '#00D4AA' },
      { id: 6, name: 'SueÃ±o 8h', emoji: 'ğŸ˜´', startDate: '2025-02-10', color: '#8B5CF6' },
    ],
    books: [
      { id: 1, title: 'Atomic Habits', author: 'James Clear', cat: 'Productividad', status: 'âœ… LeÃ­do', rating: 5 },
      { id: 2, title: 'El Hombre en Busca de Sentido', author: 'Viktor Frankl', cat: 'FilosofÃ­a', status: 'âœ… LeÃ­do', rating: 5 },
      { id: 3, title: "Can't Hurt Me", author: 'David Goggins', cat: 'Mentalidad', status: 'ğŸ“– Leyendo', rating: 0 },
      { id: 4, title: 'Deep Work', author: 'Cal Newport', cat: 'Productividad', status: 'ğŸ“‹ Pendiente', rating: 0 },
      { id: 5, title: 'Influence', author: 'Robert Cialdini', cat: 'Social', status: 'ğŸ“‹ Pendiente', rating: 0 },
    ],
    topics: [
      { id: 1, name: 'Python / ProgramaciÃ³n', source: 'Udemy', format: 'Curso Online', pct: 65, hours: 40 },
      { id: 2, name: 'NutriciÃ³n Deportiva', source: 'YouTube + Libros', format: 'Mixto', pct: 40, hours: 15 },
      { id: 3, name: 'InglÃ©s Avanzado', source: 'Duolingo + Podcast', format: 'App + Audio', pct: 70, hours: 30 },
      { id: 4, name: 'Inversiones', source: 'Podcast / Libros', format: 'Mixto', pct: 20, hours: 8 },
    ],
    contacts: [
      { id: 1, name: '[Agregar contacto]', role: 'ProfesiÃ³n', how: 'CÃ³mo lo conociste', interests: 'Intereses comunes', bday: '' },
    ],
    birthdays: [
      { name: 'MamÃ¡', rel: 'Familia', date: '15/03', gift: 'Experiencia memorable' },
      { name: 'PapÃ¡', rel: 'Familia', date: '22/07', gift: 'Por definir' },
    ],
    exposures: [
      { date: '2025-02-10', act: 'IniciÃ© conversaciÃ³n en el gym', people: 'Desconocido', discomfort: 2, note: 'Fue mÃ¡s fÃ¡cil de lo que pensÃ©' },
      { date: '2025-02-15', act: 'HablÃ© en reuniÃ³n de trabajo', people: 'Equipo completo', discomfort: 3, note: 'Me preparÃ© mejor esta vez' },
      { date: '2025-02-20', act: 'AsistÃ­ a evento de networking', people: '5+ personas nuevas', discomfort: 4, note: 'Fue incÃ³modo pero valiÃ³ la pena' },
    ],
  };
}

let state = loadState();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const tabs = ['training','habits','mind','social'];
const titles = { training:'ğŸ‹ï¸ Training', habits:'ğŸŒ± HÃ¡bitos', mind:'ğŸ“š Mente', social:'ğŸ¤ Social' };

function switchTab(tab) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(`screen-${tab}`).classList.add('active');
  document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
  document.getElementById('headerTitle').textContent = titles[tab];
  updateHeaderStreak(tab);
  window.scrollTo(0, 0);
}

function updateHeaderStreak(tab) {
  const el = document.getElementById('headerStreak');
  if (tab === 'habits') {
    const maxStreak = Math.max(...state.habits.map(h => calcDays(h.startDate)));
    el.innerHTML = `ğŸ”¥ ${maxStreak}d racha mÃ¡x`;
    el.style.display = 'flex';
  } else if (tab === 'training') {
    el.innerHTML = `ğŸ’ª ${state.sessions.length} sesiones`;
    el.style.display = 'flex';
  } else if (tab === 'mind') {
    const read = state.books.filter(b => b.status === 'âœ… LeÃ­do').length;
    el.innerHTML = `ğŸ“š ${read} libros`;
    el.style.display = 'flex';
  } else {
    el.style.display = 'none';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function calcDays(dateStr) {
  const start = new Date(dateStr);
  const now = new Date();
  return Math.max(0, Math.floor((now - start) / (1000 * 60 * 60 * 24)));
}

function formatDate(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  return d.toLocaleDateString('es-CL', { weekday: 'long', day: 'numeric', month: 'long' });
}

function closeModal() {
  document.getElementById('sessionModal').classList.remove('open');
}

function round25(val) { return Math.round(val / 2.5) * 2.5; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRAINING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderTraining() {
  const trainedDays = new Set(state.sessions.map(s => parseInt(s.date.split('-')[2])));
  const grid = document.getElementById('monthGrid');
  grid.innerHTML = '';
  
  // Feb 2025 starts on Saturday (6th col, index 5)
  const startOffset = 5; // Sat
  const daysInMonth = 28;
  const today = new Date().getDate();
  
  // fragment with offset
  const frag = document.createDocumentFragment();
  
  for (let i = 0; i < startOffset; i++) {
    const d = document.createElement('div');
    d.className = 'month-day empty'; d.textContent = '';
    frag.appendChild(d);
  }
  
  for (let day = 1; day <= daysInMonth; day++) {
    const d = document.createElement('div');
    const isTrained = trainedDays.has(day);
    const isToday = day === today;
    d.className = `month-day ${isTrained ? 'trained' : 'rest'}${isToday ? ' today' : ''}`;
    d.textContent = day;
    if (isTrained) {
      d.addEventListener('click', () => openSession(day));
    }
    frag.appendChild(d);
  }
  
  grid.appendChild(frag);
  
  document.getElementById('sessionCount').textContent = `${state.sessions.length} sesiones`;

  // Projection
  const basics = [
    { name: 'Sentadilla', key: 'Sentadilla' },
    { name: 'Peso Muerto', key: 'Peso Muerto' },
    { name: 'Press Banca', key: 'Press Banca' },
    { name: 'Press Militar', key: 'Press Militar' },
    { name: 'Remo c/B.', key: 'Remo con Barra' },
  ];

  const tbody = document.getElementById('projectionTable');
  tbody.innerHTML = '';

  basics.forEach(b => {
    // Find most recent weight for this exercise
    let current = 0;
    for (let i = state.sessions.length - 1; i >= 0; i--) {
      const ex = state.sessions[i].exercises.find(e => e.name.includes(b.key.split(' ')[0]));
      if (ex && ex.weight > 0) { current = ex.weight; break; }
    }
    if (!current) return;

    const s2 = round25(current * 1.025);
    const s4 = round25(current * Math.pow(1.025, 3));
    const m3 = round25(current * Math.pow(1.025, 12));

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="ex-col">${b.name}</td>
      <td>${current}</td>
      <td>${s2}</td>
      <td>${s4}</td>
      <td class="highlight">${m3}</td>
    `;
    tbody.appendChild(tr);
  });
}

function openSession(day) {
  const dateStr = `2025-02-${String(day).padStart(2,'0')}`;
  const session = state.sessions.find(s => s.date === dateStr);
  if (!session) return;

  document.getElementById('modalDate').textContent = formatDate(dateStr);
  document.getElementById('modalSub').textContent = `${session.exercises.length} ejercicios Â· ${session.exercises.filter(e=>e.weight>0).reduce((a,e)=>Math.max(a,e.weight),0)} kg mÃ¡ximo`;

  const content = document.getElementById('modalContent');
  content.innerHTML = session.exercises.map(ex => `
    <div class="exercise-row">
      <div>
        <div class="ex-name">${ex.name}</div>
        <div class="ex-cat">${ex.cat}</div>
      </div>
      <div class="ex-stats">
        <div class="ex-weight">${ex.weight > 0 ? ex.weight + ' kg' : 'Peso corporal'}</div>
        <div class="ex-detail">${ex.sets} Ã— ${ex.reps}</div>
      </div>
    </div>
  `).join('');

  document.getElementById('sessionModal').classList.add('open');
}

function addExerciseInput() {
  const container = document.getElementById('exerciseInputs');
  const div = document.createElement('div');
  div.innerHTML = `
    <hr style="border-color:var(--border);margin:12px 0">
    <div class="form-row">
      <div class="form-group"><input type="text" class="ex-name-in" placeholder="Ejercicio"></div>
      <div class="form-group"><input type="text" class="ex-cat-in" placeholder="CategorÃ­a"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><input type="number" class="ex-sets-in" placeholder="Series"></div>
      <div class="form-group"><input type="number" class="ex-reps-in" placeholder="Reps"></div>
    </div>
    <div class="form-group"><input type="number" class="ex-weight-in" placeholder="Peso kg" step="0.5"></div>
  `;
  container.appendChild(div);
}

function saveSession() {
  const date = document.getElementById('sessionDate').value;
  if (!date) { alert('Selecciona una fecha'); return; }

  const names = document.querySelectorAll('.ex-name-in');
  const cats = document.querySelectorAll('.ex-cat-in');
  const sets = document.querySelectorAll('.ex-sets-in');
  const reps = document.querySelectorAll('.ex-reps-in');
  const weights = document.querySelectorAll('.ex-weight-in');

  const exercises = [];
  for (let i = 0; i < names.length; i++) {
    if (names[i].value.trim()) {
      exercises.push({
        name: names[i].value.trim(),
        cat: cats[i].value.trim() || 'General',
        sets: parseInt(sets[i].value) || 0,
        reps: parseInt(reps[i].value) || 0,
        weight: parseFloat(weights[i].value) || 0,
      });
    }
  }

  if (!exercises.length) { alert('Agrega al menos un ejercicio'); return; }

  const existing = state.sessions.findIndex(s => s.date === date);
  if (existing >= 0) state.sessions[existing].exercises.push(...exercises);
  else state.sessions.push({ date, exercises });

  state.sessions.sort((a, b) => a.date.localeCompare(b.date));
  saveState();
  document.getElementById('addSessionModal').classList.remove('open');
  renderTraining();
  renderHabits(); // update calendar
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HABITS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const habitColors = ['#FF6B35','#FF4444','#F59E0B','#FFCC00','#00D4AA','#8B5CF6','#22C55E','#00BFFF'];

function renderHabits() {
  const container = document.getElementById('habitsContainer');
  container.innerHTML = '';

  state.habits.forEach((h, idx) => {
    const days = calcDays(h.startDate);
    const pct = Math.min(100, (days / 90) * 100);
    const color = h.color || habitColors[idx % habitColors.length];
    const status = days >= 90 ? 'ğŸ†' : days >= 30 ? 'ğŸ”¥' : days >= 14 ? 'âœ…' : days >= 7 ? 'ğŸŸ¡' : 'ğŸ”´';

    const div = document.createElement('div');
    div.className = 'habit-streak-card';
    div.innerHTML = `
      <div class="habit-icon">${h.emoji}</div>
      <div class="habit-info">
        <div class="habit-name">${h.name}</div>
        <div class="habit-meta">Desde ${new Date(h.startDate).toLocaleDateString('es-CL',{day:'numeric',month:'short'})}</div>
        <div class="streak-bar-wrap">
          <div class="streak-bar" style="width:${pct}%;background:${color}"></div>
        </div>
      </div>
      <div>
        <div class="habit-streak-num" style="color:${color}">${days}</div>
        <div class="habit-streak-unit">dÃ­as ${status}</div>
      </div>
    `;
    container.appendChild(div);
  });

  // Mini calendar
  const trainedDays = new Set(state.sessions.map(s => parseInt(s.date.split('-')[2])));
  document.getElementById('trainedCount').textContent = `${trainedDays.size} dÃ­as âœ…`;

  const calGrid = document.getElementById('calMiniGrid');
  calGrid.innerHTML = '';
  const frag = document.createDocumentFragment();

  for (let i = 0; i < 5; i++) {
    const d = document.createElement('div'); d.className='cal-day e'; frag.appendChild(d);
  }
  for (let day = 1; day <= 28; day++) {
    const d = document.createElement('div');
    d.className = `cal-day ${trainedDays.has(day) ? 't' : 'r'}`;
    d.textContent = day;
    frag.appendChild(d);
  }
  calGrid.appendChild(frag);
}

function addHabit() {
  const name = document.getElementById('newHabitName').value.trim();
  const emoji = document.getElementById('newHabitEmoji').value.trim() || 'ğŸ¯';
  const date = document.getElementById('newHabitDate').value;
  if (!name || !date) { alert('Completa todos los campos'); return; }
  
  const newId = Math.max(0, ...state.habits.map(h => h.id)) + 1;
  state.habits.push({ id: newId, name, emoji, startDate: date, color: habitColors[newId % habitColors.length] });
  saveState();
  document.getElementById('addHabitModal').classList.remove('open');
  document.getElementById('newHabitName').value = '';
  document.getElementById('newHabitEmoji').value = '';
  renderHabits();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MIND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const bookColors = ['#8B5CF6','#6C63FF','#A855F7','#7C3AED'];
const statusColor = { 'âœ… LeÃ­do': '#22C55E', 'ğŸ“– Leyendo': '#F59E0B', 'ğŸ“‹ Pendiente': '#6B7280' };

function renderMind() {
  const read = state.books.filter(b => b.status === 'âœ… LeÃ­do').length;
  const active = state.topics.length;
  document.getElementById('booksReadCount').textContent = read;
  document.getElementById('topicsCount').textContent = active;

  const booksEl = document.getElementById('booksContainer');
  booksEl.innerHTML = '';
  state.books.forEach((b, i) => {
    const col = bookColors[i % bookColors.length];
    const sc = statusColor[b.status] || '#6B7280';
    const stars = b.rating ? 'â­'.repeat(b.rating) : '';
    const div = document.createElement('div');
    div.className = 'book-card';
    div.innerHTML = `
      <div class="book-cover" style="background:${col}22;color:${col}">ğŸ“—</div>
      <div class="book-info">
        <div class="book-title">${b.title}</div>
        <div class="book-author">${b.author} Â· ${b.cat}</div>
        <span class="book-status" style="background:${sc}22;color:${sc}">${b.status}</span>
        ${stars ? `<div style="margin-top:5px;font-size:12px">${stars}</div>` : ''}
      </div>
    `;
    booksEl.appendChild(div);
  });

  const topicsEl = document.getElementById('topicsContainer');
  topicsEl.innerHTML = '';
  state.topics.forEach((t, i) => {
    const col = ['#00D4AA','#FF6B35','#8B5CF6','#F59E0B'][i % 4];
    const div = document.createElement('div');
    div.className = 'topic-card';
    div.innerHTML = `
      <div class="topic-header">
        <div class="topic-name">${t.name}</div>
        <div class="topic-pct" style="color:${col}">${t.pct}%</div>
      </div>
      <div class="topic-meta">${t.source} Â· ${t.format} Â· ${t.hours}h dedicadas</div>
      <div class="topic-bar-wrap">
        <div class="topic-bar" style="width:${t.pct}%;background:${col}"></div>
      </div>
    `;
    topicsEl.appendChild(div);
  });
}

function addBook() {
  const title = document.getElementById('bookTitle').value.trim();
  const author = document.getElementById('bookAuthor').value.trim();
  const cat = document.getElementById('bookCat').value.trim() || 'General';
  const status = document.getElementById('bookStatus').value;
  const rating = parseInt(document.getElementById('bookRating').value) || 0;
  if (!title) { alert('Agrega el tÃ­tulo'); return; }
  
  const newId = Math.max(0, ...state.books.map(b => b.id)) + 1;
  state.books.unshift({ id: newId, title, author, cat, status, rating });
  saveState();
  document.getElementById('addBookModal').classList.remove('open');
  document.getElementById('bookTitle').value = '';
  document.getElementById('bookAuthor').value = '';
  renderMind();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SOCIAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const contactEmojis = ['ğŸ‘¤','ğŸ§‘','ğŸ‘©','ğŸ§‘â€ğŸ’¼','ğŸ‘¨â€ğŸ’¼','ğŸ§‘â€ğŸ”¬','ğŸ‘©â€ğŸ«','ğŸ‘¨â€ğŸ¨'];

function renderSocial() {
  document.getElementById('contactsCount').textContent = state.contacts.length;
  document.getElementById('exposuresCount').textContent = state.exposures.length;

  // Birthdays
  const bdayEl = document.getElementById('bdayContainer');
  bdayEl.innerHTML = '';
  state.birthdays.forEach((b, i) => {
    const cols = ['rgba(245,158,11,0.2)','rgba(255,107,53,0.2)','rgba(139,92,246,0.2)'];
    const div = document.createElement('div');
    div.className = 'bday-row';
    div.innerHTML = `
      <div class="bday-avatar" style="background:${cols[i%cols.length]}">ğŸ‚</div>
      <div class="bday-info">
        <div class="bday-name">${b.name}</div>
        <div class="bday-rel">${b.rel}</div>
      </div>
      <div>
        <div class="bday-date">${b.date}</div>
        <div class="bday-days">${b.gift}</div>
      </div>
    `;
    bdayEl.appendChild(div);
  });

  // Contacts
  const contEl = document.getElementById('contactsContainer');
  contEl.innerHTML = '';
  state.contacts.forEach((c, i) => {
    const div = document.createElement('div');
    div.className = 'contact-card';
    div.innerHTML = `
      <div class="contact-header">
        <div class="contact-avatar">${contactEmojis[i % contactEmojis.length]}</div>
        <div>
          <div class="contact-name">${c.name}</div>
          <div class="contact-role">${c.role}</div>
        </div>
      </div>
      <div class="contact-tags">
        ${c.how ? `<span class="tag">ğŸ“ ${c.how}</span>` : ''}
        ${c.interests ? `<span class="tag">ğŸ’¡ ${c.interests}</span>` : ''}
        ${c.bday ? `<span class="tag">ğŸ‚ ${c.bday}</span>` : ''}
      </div>
    `;
    contEl.appendChild(div);
  });

  // Exposure
  const expEl = document.getElementById('exposureContainer');
  expEl.innerHTML = '';
  [...state.exposures].reverse().forEach(e => {
    const col = e.discomfort >= 4 ? '#FF6B35' : e.discomfort >= 3 ? '#F59E0B' : '#22C55E';
    const div = document.createElement('div');
    div.className = 'exposure-row';
    div.innerHTML = `
      <div class="exposure-dots">
        <div class="e-dot" style="background:${col}"></div>
        <div style="width:1px;height:30px;background:var(--border);margin:2px 0"></div>
      </div>
      <div class="exposure-content">
        <div class="exposure-act">${e.act}</div>
        <div class="exposure-meta">${e.date} Â· ${e.people}</div>
        <div class="discomfort">${Array(e.discomfort).fill('ğŸ”¥').join('')}${Array(5-e.discomfort).fill('âš«').join('')}</div>
        ${e.note ? `<div style="font-size:11px;color:var(--muted);margin-top:4px;font-style:italic">"${e.note}"</div>` : ''}
      </div>
    `;
    expEl.appendChild(div);
  });
}

function addContact() {
  const name = document.getElementById('contactName').value.trim();
  if (!name) { alert('Agrega el nombre'); return; }
  const newId = Math.max(0, ...state.contacts.map(c => c.id || 0)) + 1;
  state.contacts.push({
    id: newId,
    name,
    role: document.getElementById('contactRole').value.trim(),
    how: document.getElementById('contactHow').value.trim(),
    interests: document.getElementById('contactInterests').value.trim(),
    bday: document.getElementById('contactBday').value.trim(),
  });
  saveState();
  document.getElementById('addContactModal').classList.remove('open');
  document.getElementById('contactName').value = '';
  renderSocial();
}

function addExposure() {
  const act = document.getElementById('expAct').value.trim();
  if (!act) { alert('Describe la actividad'); return; }
  state.exposures.push({
    date: new Date().toISOString().slice(0,10),
    act,
    people: document.getElementById('expPeople').value.trim(),
    discomfort: parseInt(document.getElementById('expDiscomfort').value) || 1,
    note: document.getElementById('expNote').value.trim(),
  });
  saveState();
  document.getElementById('addExposureModal').classList.remove('open');
  document.getElementById('expAct').value = '';
  document.getElementById('expNote').value = '';
  renderSocial();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HEADER DATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initHeader() {
  const now = new Date();
  document.getElementById('headerDate').textContent =
    now.toLocaleDateString('es-CL', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
  updateHeaderStreak('training');
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(m => {
  m.addEventListener('click', e => {
    if (e.target === m) m.classList.remove('open');
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

initHeader();
renderTraining();
renderHabits();
renderMind();
renderSocial();
</script>
</body>
</html>
